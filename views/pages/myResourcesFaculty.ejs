<%- include('../components/header'); -%>
<%- include('../components/navbar'); -%>

<% let tags = ['agriculture'
    , 'arts and culture'
    , 'cannabis'
    , 'consumer protection'
    , 'COVID-19'
    , 'criminal justice'
    , 'disability'
    , 'education'
    , 'elderly'
    , 'energy'
    , 'environment/climate change'
    , 'gun control'
    , 'healthcare'
    , 'higher education'
    , 'housing and homelessness'
    , 'immigration'
    , 'labor'
    , 'LGBTQ+'
    , 'mental health'
    , 'opioids'
    , 'public health'
    , 'public safety'
    , 'race'
    , 'substance use and recovery'
    , 'taxes'
    , 'technology'
    , 'tourism'
    , 'transportation'
    , 'veterans'
    , 'violence and sexual assault'
    , 'voting'
    , 'women and gender']

let syllabus = ['online course', 'course with internship content', 'full-semester course', 'half-semester course']
%>

<section class='section'>
    <div class='section__content section__content--full-width'>
        <div class='jumbotron masthead text-center'>
            <div class='section__title section__title--centered'>
                My Resources
            </div>
            <p id='id-clicked'>Debug message, will be removed soon :)</p>
        </div>
    </div>
</section>


<section class='section section__grey' data-aos='fade-up'>
    <section class='section__content section__content--fluid-width'>
        <div class='container'>
            <div class='row'>
                <% if (loggedIn) { %>
                    <div class='col-md-12 col-sm-12'>
                        <% if (resourceInfo && resourceInfo.length > 0) { %>
                            <% for (let i = resourceInfo.length - 1; i >= 0; i--) { %>
                                <div class='card-body'>
                                    <h4><%= resourceInfo[i].name %></h4>
                                    <div class='card-text'>
                                        <ul class='list-group'>
                                            <li class='list-group-item borderless box-padding'>
                                                <b>Description: </b> <%= resourceInfo[i].description %></li>
                                            <li class='list-group-item borderless box-padding'>
                                                <b>Year: </b> <%= resourceInfo[i].yearOfCreation %>
                                            </li>
                                            <li class='list-group-item borderless box-padding'>
                                                <b>State:</b> <%= resourceInfo[i].state %></li>
                                            <% if (resourceInfo[i].mediaType === 'video') { %>
                                                <li class='list-group-item borderless box-padding'>
                                                    <video width="400" controls>
                                                        <source src="<%= resourceInfo[i].uri %>" type="video/mp4">
                                                    </video>
                                                </li>
                                            <% } else { %>
                                                <li class='list-group-item borderless box-padding'>
                                                    <b>Link: </b> <a href='<%= resourceInfo[i].uri %>'>click me</a>
                                                </li>
                                            <% } %>
                                            <li class='list-group-item borderless box-padding'>
                                                <b>Institution: </b> <%= resourceInfo[i].institution %>
                                            </li>
                                            <li class='list-group-item borderless box-padding'>
                                                <b>Author: </b> <%= resourceInfo[i].ownerName %>
                                            </li>
                                            <% if (resourceInfo[i].tags.length >= 1 && resourceInfo[i].tags[0].length !== 0) { %>
                                                <li class='list-group-item borderless box-padding'>
                                                    <b>Tags:</b> <%= resourceInfo[i].tags %>
                                                </li>
                                            <% } %>
                                            <li class='list-group-item borderless box-padding'>
                                                <b>Actions:</b>
                                                <button id="<%= resourceInfo[i]._id %>" type='button'
                                                        class='editBtn btn btn-outline-info'
                                                        style='border:0 solid transparent'
                                                        data-toggle='modal'
                                                        data-target='#editModal'>
                                                    Edit
                                                </button>
                                                <button id="<%= resourceInfo[i]._id %>" type='button'
                                                        class='deleteBtn btn btn-outline-danger'
                                                        style='border:0px solid transparent'
                                                        data-toggle='modal'
                                                        data-target='#deleteModal'>
                                                    Delete
                                                </button>
                                                <% if (status === 'admin') { %>
                                                    <a href='/resource/update/<%= resourceInfo[i]._id %>/my'>
                                                        <input class='btn btn-outline-primary'
                                                               style='border:0px solid transparent'
                                                               type='button' value='Change author'></a>
                                                <% } %>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                                <% if (i !== 0) { %>
                                    <br>
                                <% } %>
                            <% } %>
                        <% } else { %>
                            <div class='card-body text-center'>
                                No resource available yet
                            </div>
                        <% } %>
                    </div>
                <% } else { %>
                    <%- include('../components/component-loginToView'); -%>
                <% } %>
            </div>
        </div>
    </section>
</section>

<!-- Modal -->
<div class='modal fade' id='deleteModal' tabindex='-1' role='dialog'
     aria-labelledby='exampleModalLabel'
     aria-hidden='true'>
    <div class='modal-dialog modal-lg' role='document'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h5 class='modal-title' id='exampleModalLabel'>Delete?</h5>
                <button type='button' class='close' data-dismiss='modal' aria-label='Close'>
                    <span aria-hidden='true'>&times;</span>
                </button>
            </div>
            <div class='modal-body'>
                <div class='row'>
                    <div class='col-md-12 col-sm-12'>
                        <h4>Are you sure you want to delete this resource permanently?</h4>
                    </div>
                </div>
            </div>
            <div class='modal-footer'>
                <form id='deleteForm' method='post' action="">
                    <input type='submit' name='submit' class='btn btn-outline-danger' value='Delete'>
                </form>
                <button type='button' id='closeBtn' class='btn btn-outline-secondary' data-dismiss='modal'>
                    Close
                </button>
            </div>
        </div>
    </div>
</div>

<div class='modal fade' id='editModal' tabindex='-1' role='dialog'
     aria-labelledby='exampleModalLabel'
     aria-hidden='true'>
    <div class='modal-dialog modal-lg' role='document'>
        <form id="editForm" method='post' action=''>
            <div class='modal-content'>
                <div class='modal-header'>
                    <h5 class='modal-title' id='exampleModalLabel'>Edit</h5>
                    <button type='button' class='close' data-dismiss='modal' aria-label='Close'>
                        <span aria-hidden='true'>&times;</span>
                    </button>
                </div>
                <div class='modal-body'>
                    <div class='row'>
                        <div class='col-md-12 col-sm-12'>
                            <h3>Author(s)</h3>
                            <hr>
                            <h5 style="color: grey">Please make sure to spell the name and email correctly. <br>
                                If you wish to remove one or more authors from the list, please contact us. </h5>
                            Existing authors: <h6 id="ownerNames"></h6>
                            <div class="form-horizontal" id="form-horizontal">
                            </div>
                            <br>
                            <input class="btn btn-outline-primary" type='button' value='Add another author'
                                   id='addButton'/>
                            <input class="btn btn-outline-info" type='button' value='Remove last entered author'
                                   id='removeButton'/>
                            <br><br><br>

                            <h3>Basic information</h3>
                            <hr>
                            <% if (status === 'faculty' || status === 'admin') { %>
                                <div class='input-group-prepend'>
                                    <span class='input-group-text' style='width: 180px'>Content Type</span>
                                    <select id='contentTypeSelect'
                                            class='form-control' name='contentType'>
                                        <option selected value='empty'>Choose...</option>
                                        <option value='Advocacy Video'>Advocacy Video</option>
                                        <option value='Assignment Guidelines'>Assignment Guidelines & Rubrics
                                        </option>
                                        <option value='Journal'>Campaign Journal/Personal Reflections</option>
                                        <option value='Course Planning'>Course Planning</option>
                                        <option value='Course Reading'>Course Reading</option>
                                        <option value='Elevator Speech'>Elevator Speech</option>
                                        <option value='ENACT Research'>ENACT Faculty Research</option>
                                        <option value='Flyer'>Fact Sheet/Storybook</option>
                                        <option value='Letter to Legislator'>Letter to the Legislator</option>
                                        <option value='Next Steps'>Next Steps</option>
                                        <option value='Online'>Online Teaching Resources</option>
                                        <option value='Outlets'>Outlets for Publication</option>
                                        <option value='Op-Ed'>Op-Ed</option>
                                        <option value='Personal Reflection'>Essays about ENACT</option>
                                        <option value='Portfolio'>Portfolio</option>
                                        <option value='Presentations'>Presentations</option>
                                        <option value='Research Report'>Student Research Report</option>
                                        <option value='Script'>Script for meeting with Ways and Means Staff
                                        </option>
                                        <option value='State Legislative'>State Legislative Website Resources
                                        </option>
                                        <option value='Syllabus'>Syllabi</option>
                                        <option value='Testimony'>Testimony</option>
                                    </select>
                                </div>
                            <% } else { %>
                                <div class='input-group-prepend'>
                                    <span class='input-group-text' style='width: 180px'>Content Type</span>
                                    <select id='contentTypeSelect'
                                            class='form-control'
                                            name='contentType'>
                                        <option selected value='empty'>Choose...</option>
                                        <option value='Advocacy Video'>Advocacy Video</option>
                                        <option value='Journal'>Campaign Journal/Personal Reflections</option>
                                        <option value='Elevator Speech'>Elevator Speech</option>
                                        <option value='Flyer'>Fact Sheet/Storybook</option>
                                        <option value='Letter to Legislator'>Letter to the Legislator</option>
                                        <option value='Next Steps'>Next Steps</option>
                                        <option value='Outlets'>Outlets for Publication</option>
                                        <option value='Op-Ed'>Op-Ed</option>
                                        <option value='Personal Reflection'>Essays about ENACT</option>
                                        <option value='Portfolio'>Portfolio</option>
                                        <option value='Presentations'>Presentations</option>
                                        <option value='Research Report'>Student Research Report</option>
                                        <option value='Script'>Script for meeting with Ways and Means Staff
                                        </option>
                                        <option value='State Legislative'>State Legislative Website Resources
                                        </option>
                                        <option value='Testimony'>Testimony</option>
                                    </select>
                                </div>
                            <% } %>
                            <br>
                            <div class='input-group-prepend'>
                                <span class='input-group-text' style='width: 180px'>Resource Name</span>
                                <input type='text' id='resourceName' class='form-control'
                                       name='resourceName'>
                            </div>
                            <br>
                            <div class='input-group-prepend'>
                                <span class='input-group-text' style='width: 180px'>Description</span>
                                <textarea id="description" type='text' class='form-control' name='description'
                                          rows='4'></textarea>
                            </div>
                            <br>
                            <div class='input-group-prepend'>
                                <span class='input-group-text' style='width: 180px'>URI</span>
                                <input type='text' id='fileURL' class='form-control' name='uri'>
                            </div>
                            <br>
                            <div class='input-group-prepend'>
                                <span class='input-group-text' style='width: 180px'>Media Type</span>
                                <select id='mediaTypeSelect' class='form-control'
                                        name='mediaType'>
                                    <option selected value='empty'>Choose...</option>
                                    <option value='document'>Document</option>
                                    <option value='photo'>Photo</option>
                                    <option value='PowerPoint'>PowerPoint</option>
                                    <option value='video'>Video</option>
                                </select>
                            </div>
                            <br>
                            <div class='input-group-prepend'>
                                <span class='input-group-text' style='width: 180px'>State</span>
                                <select id='stateSelect' class='form-control'
                                        name='state'>
                                    <option selected value="empty">Choose...</option>
                                    <option value="Not state-specific">Not state-specific</option>
                                    <option value='AL'>Alabama</option>
                                    <option value='AK'>Alaska</option>
                                    <option value='AZ'>Arizona</option>
                                    <option value='AR'>Arkansas</option>
                                    <option value='CA'>California</option>
                                    <option value='CO'>Colorado</option>
                                    <option value='CT'>Connecticut</option>
                                    <option value='DE'>Delaware</option>
                                    <option value='DC'>District Of Columbia</option>
                                    <option value='FL'>Florida</option>
                                    <option value='GA'>Georgia</option>
                                    <option value='HI'>Hawaii</option>
                                    <option value='ID'>Idaho</option>
                                    <option value='IL'>Illinois</option>
                                    <option value='IN'>Indiana</option>
                                    <option value='IA'>Iowa</option>
                                    <option value='KS'>Kansas</option>
                                    <option value='KY'>Kentucky</option>
                                    <option value='LA'>Louisiana</option>
                                    <option value='ME'>Maine</option>
                                    <option value='MD'>Maryland</option>
                                    <option value='MA'>Massachusetts</option>
                                    <option value='MI'>Michigan</option>
                                    <option value='MN'>Minnesota</option>
                                    <option value='MS'>Mississippi</option>
                                    <option value='MO'>Missouri</option>
                                    <option value='MT'>Montana</option>
                                    <option value='NE'>Nebraska</option>
                                    <option value='NV'>Nevada</option>
                                    <option value='NH'>New Hampshire</option>
                                    <option value='NJ'>New Jersey</option>
                                    <option value='NM'>New Mexico</option>
                                    <option value='NY'>New York</option>
                                    <option value='NC'>North Carolina</option>
                                    <option value='ND'>North Dakota</option>
                                    <option value='OH'>Ohio</option>
                                    <option value='OK'>Oklahoma</option>
                                    <option value='OR'>Oregon</option>
                                    <option value='PA'>Pennsylvania</option>
                                    <option value='RI'>Rhode Island</option>
                                    <option value='SC'>South Carolina</option>
                                    <option value='SD'>South Dakota</option>
                                    <option value='TN'>Tennessee</option>
                                    <option value='TX'>Texas</option>
                                    <option value='UT'>Utah</option>
                                    <option value='VT'>Vermont</option>
                                    <option value='VA'>Virginia</option>
                                    <option value='WA'>Washington</option>
                                    <option value='WV'>West Virginia</option>
                                    <option value='WI'>Wisconsin</option>
                                    <option value='WY'>Wyoming</option>
                                </select>
                            </div>
                            <br>
                            <div class='input-group-prepend'>
                                <span class='input-group-text' style='width: 180px'>Institution</span>
                                <input type='text' id="institution" class='form-control' name='institution'>
                            </div>
                            <br>
                            <div class='input-group-prepend'>
                                <span class='input-group-text' style='width: 180px'>Creation Year</span>
                                <input id="yearOfCreation" type='text' class='form-control' name='yearOfCreation'>
                            </div>
                            <br>
                            <% if (status === 'admin' || status === 'faculty') { %>
                                <div class='input-group-prepend'>
                                                <span class='input-group-text'
                                                      style='width: 180px'>Resource Status</span>
                                    <select id='statusSelect' class='form-control'
                                            name='status'>
                                        <option value='privateToENACT'>Exclusive to all ENACT members</option>
                                        <option value='privateToProfessor'>Exclusive to ENACT professors</option>
                                        <% if (status === 'admin') { %>
                                            <option value='public'>Open to public</option>
                                            <option value='finalPublic'>Displayed on the front page</option>
                                        <% } else { %>
                                            <option value='partPublic'>Open to public (needs admin approval)</option>
                                        <% } %>
                                    </select>
                                </div>
                                <br>
                            <% } else { %>
                                <div class='input-group-prepend'>
                                                <span class='input-group-text'
                                                      style='width: 180px'>Resource Status</span>
                                    <select id='statusSelect' class='form-control'
                                            name='status'>
                                        <option value='privateToENACT'>Exclusive to all ENACT members</option>
                                        <option value='partPublic'>Open to public</option>
                                    </select>
                                </div>
                            <% } %>
                        </div>

                        <br>

                        <div class='toShow col-md-12 col-sm-12'
                             id="toShow">
                            <h3>Area of the resource (Optional)</h3>
                            <hr>
                        </div>

                        <div class='toShow2 col-md-12 col-sm-12'
                             id="toShow">
                            <h3>Area of the resource (Optional)</h3>
                            <hr>
                        </div>

                        <% for (let m = 0; m < tags.length;) { %>
                            <% for (let r = 0; m < tags.length && r < 2; m++, r++) { %>
                                <div class='toShow col-md-6 col-sm-12 text-md-right'>
                                    <div class='input-group' style='padding-bottom: 10px'>
                                        <div class='input-group-prepend'>
                                            <div class='input-group-text'>
                                                <input class='checkbox-double'
                                                       type='checkbox'
                                                       value='<%= tags[m] %>'><br>
                                            </div>
                                        </div>
                                        <input disabled type='text' class='form-control'
                                               aria-label='Text input with checkbox' value='<%= tags[m] %>'>
                                    </div>
                                </div>
                            <% } %>
                            <div class='w-100'></div>
                        <% } %>

                        <% for (let m = 0; m < syllabus.length;) { %>
                            <% for (let r = 0; m < syllabus.length && r < 2; m++, r++) { %>
                                <div class='toShow2 col-md-6 col-sm-12 text-md-right'>
                                    <div class='input-group' style='padding-bottom: 10px'>
                                        <div class='input-group-prepend'>
                                            <div class='input-group-text'>
                                                <input class='checkbox-double'
                                                       type='checkbox'
                                                       value='<%= syllabus[m] %>'><br>
                                            </div>
                                        </div>
                                        <input disabled type='text' class='form-control'
                                               aria-label='Text input with checkbox' value='<%= syllabus[m] %>'>
                                    </div>
                                </div>
                            <% } %>
                            <div class='w-100'></div>
                        <% } %>

                        <input hidden id='tagsToReturn' type='text'
                               class='form-control' name='selectedTags' value=''>
                        <br>
                        <div class='w-100'></div>
                    </div>
                </div>
                <div class='modal-footer'>
                    <input type='submit' name='submit' class='btn btn-outline-primary' value='Save'>
                    <button type='button' id='closeBtn' class='btn btn-outline-secondary' data-dismiss='modal'>
                        Close
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<script src="/js/authorship.js"></script>
<script>
    $(document).ready(function () {
        // Delete modal
        $('#deleteModal').hide()
        $(".deleteBtn").click(function () {
            $('#id-clicked').text(this.id)
            let resource = null
            $.ajax({
                type: 'GET',
                url: '/resource/' + this.id,
                async: false,
                dataType: 'json',
                success: function (data) {
                    resource = data
                    // change form action attribute
                    $('#deleteForm').attr('action', '/resource/remove/' + resource._id)
                    $('#deleteModal').show()
                }
            });
        });

        // Edit modal
        $('#editModal').hide()
        $(".editBtn").click(function () {
            $('#id-clicked').text(this.id)
            let resource = null
            $.ajax({
                type: 'GET',
                url: '/resource/' + this.id,
                async: false,
                dataType: 'json',
                success: function (data) {
                    resource = data
                    console.log("Resource: ", resource)
                    console.log(resource.name)
                    $('#ownerNames').text(resource.ownerName)
                    $('#resourceName').val(resource.name)
                    $('#description').text(resource.description)
                    $('#fileURL').val(resource.uri)
                    $('#institution').val(resource.institution)
                    $('#yearOfCreation').val(resource.yearOfCreation)
                    let contentType = resource.contentType
                    console.log("Content type: ", resource.contentType)
                    $('#contentTypeSelect' + ' option').each(function () {
                        if ($(this).val() === contentType) {
                            $(this).prop('selected', true)
                        }
                    })
                    let mediaType = resource.mediaType
                    console.log("Content type: ", resource.mediaType)
                    $('#mediaTypeSelect' + ' option').each(function () {
                        if ($(this).val() === mediaType) {
                            $(this).prop('selected', true)
                        }
                    })
                    let state = resource.state
                    $('#stateSelect' + ' option').each(function () {
                        if ($(this).val() === state) {
                            $(this).prop('selected', true)
                        }
                    })
                    let status = resource.status
                    $('#statusSelect' + ' option').each(function () {
                        if ($(this).val() === status) {
                            $(this).prop('selected', true)
                        }
                    })
                    let tags = resource.tags.toString()
                    let tagsArray = tags.split(',')
                    $(':checkbox').each(function () {
                        if (tagsArray.includes($(this).val())) {
                            $(this).prop('checked', true)
                        }
                    })
                    let checkboxes = $(':checkbox')
                    let string = checkboxes.filter(':checked').map(function () {
                        return this.value;
                    }).get().join(',');
                    $('#tagsToReturn').val(string);
                    checkboxes.on('change', function () {
                        let string = checkboxes.filter(':checked').map(function () {
                            return this.value;
                        }).get().join(',');
                        $('#tagsToReturn').val(string);
                    })
                    // change form action attribute
                    $('#editForm').attr('action', '/resource/update/' + resource._id)
                    $('#editModal').show()
                }
            });
            // display correct tags for different content types
            let text = $('#contentTypeSelect option:selected').text();
            if (text === 'Assignment Guidelines & Rubrics' || text === 'Course Reading' || text === 'ENACT Faculty Research' || text === 'Course Planning' || text === 'Online Teaching Resources' || text === 'Outlets for Publication' || text === 'Rubrics for grading' || text === 'State Legislative Website Resources') {
                $(".toShow").hide()
                $(".toShow2").hide()
            } else if (text === 'Syllabi') {
                $(".toShow2").show()
                $(".toShow").hide()
            } else {
                $(".toShow").show()
                $(".toShow2").hide()
            }
            $("#contentTypeSelect").on("change", function () {
                text = $('#contentTypeSelect option:selected').text();
                if (text === 'Assignment Guidelines & Rubrics' || text === 'Course Reading' || text === 'ENACT Faculty Research' || text === 'Course Planning' || text === 'Online Teaching Resources' || text === 'Outlets for Publication' || text === 'Rubrics for grading' || text === 'State Legislative Website Resources') {
                    $(".toShow").hide()
                    $(".toShow2").hide()
                } else if (text === 'Syllabi') {
                    $(".toShow2").show()
                    $(".toShow").hide()
                } else {
                    $(".toShow").show()
                    $(".toShow2").hide()
                }
            })
        })
    })
</script>

<%- include('../components/footer'); -%>